# 第1章 计算机网络和因特网

<!-- MarkdownTOC autolink='true' -->

- [1.1 什么是因特网](#11-%E4%BB%80%E4%B9%88%E6%98%AF%E5%9B%A0%E7%89%B9%E7%BD%91)
	- [1.1.1 具体构成描述](#111-%E5%85%B7%E4%BD%93%E6%9E%84%E6%88%90%E6%8F%8F%E8%BF%B0)
	- [1.1.2 服务描述](#112-%E6%9C%8D%E5%8A%A1%E6%8F%8F%E8%BF%B0)
	- [1.1.3 协议](#113-%E5%8D%8F%E8%AE%AE)
- [1.2 网络边缘](#12-%E7%BD%91%E7%BB%9C%E8%BE%B9%E7%BC%98)
	- [1.2.1 接入网](#121-%E6%8E%A5%E5%85%A5%E7%BD%91)
	- [1.2.2 物理媒体](#122-%E7%89%A9%E7%90%86%E5%AA%92%E4%BD%93)
- [1.3 网络核心](#13-%E7%BD%91%E7%BB%9C%E6%A0%B8%E5%BF%83)
	- [1.3.1 分组交换](#131-%E5%88%86%E7%BB%84%E4%BA%A4%E6%8D%A2)
	- [1.3.2 电路交换](#132-%E7%94%B5%E8%B7%AF%E4%BA%A4%E6%8D%A2)
	- [1.3.3 网络的网络](#133-%E7%BD%91%E7%BB%9C%E7%9A%84%E7%BD%91%E7%BB%9C)
- [1.4 分组交换网中的时延,丢包和吞吐量](#14-%E5%88%86%E7%BB%84%E4%BA%A4%E6%8D%A2%E7%BD%91%E4%B8%AD%E7%9A%84%E6%97%B6%E5%BB%B6%E4%B8%A2%E5%8C%85%E5%92%8C%E5%90%9E%E5%90%90%E9%87%8F)
	- [1.4.1 分组交换中的时延概述](#141-%E5%88%86%E7%BB%84%E4%BA%A4%E6%8D%A2%E4%B8%AD%E7%9A%84%E6%97%B6%E5%BB%B6%E6%A6%82%E8%BF%B0)
	- [1.4.2 排队时延和丢包](#142-%E6%8E%92%E9%98%9F%E6%97%B6%E5%BB%B6%E5%92%8C%E4%B8%A2%E5%8C%85)
	- [1.4.3 端到端时延](#143-%E7%AB%AF%E5%88%B0%E7%AB%AF%E6%97%B6%E5%BB%B6)
	- [1.4.4 计算机网络中的吞吐量](#144-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%B8%AD%E7%9A%84%E5%90%9E%E5%90%90%E9%87%8F)
- [1.5 协议层次及其服务模型](#15-%E5%8D%8F%E8%AE%AE%E5%B1%82%E6%AC%A1%E5%8F%8A%E5%85%B6%E6%9C%8D%E5%8A%A1%E6%A8%A1%E5%9E%8B)
	- [1.5.1 分层的体系结构](#151-%E5%88%86%E5%B1%82%E7%9A%84%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84)
	- [1.5.2 封装](#152-%E5%B0%81%E8%A3%85)
- [1.6 面对攻击的网络](#16-%E9%9D%A2%E5%AF%B9%E6%94%BB%E5%87%BB%E7%9A%84%E7%BD%91%E7%BB%9C)

<!-- /MarkdownTOC -->


## 1.1 什么是因特网

### 1.1.1 具体构成描述

**因特网**是一个互联了遍及全世界的数以亿计的计算设备的网络

这些设备被称为**主机（host）** 或**端系统（end system）**

端系统通过**通信链路（communication link）** 和**分组交换机（packet switch）** 连接在一起

**通信链路：**

- 由不同类型的物理媒体组成：同轴电缆、铜线、光线和无线电频谱
- 不同链路传输速率不同：比特/秒（bit/s，或bps）

**分组交换机：** 从一台端系统到另一台端系统发送的数据会被分段并加上首部字节

作用：从一条入通信链路接收到达的分组，从一条出通信链路转发该分组

两种最著名的分组交换机：

- **路由器（router）：** 通常用于网络核心中
- **链路层交换机（link-layer switch）：** 通常用于接入网

**因特网服务提供商（Internet Service Provider，ISP）：** 每个ISP是一个由多个分组交换机和多端通信链路组成的网络

作用：为端系统提供各种类型的网络接入，DSL、线缆调制解调器、高速局域网接入、无线接入和血慢56kbps拨号调制解调器接入

- 低层的ISP通过国家或国际的高层ISP（Level 3 Communications、AT&T、Sprint和NTT）互连起来
- 高层的ISP由通过高速光纤链路互联的高速路由器组成

**协议（protocal）：** 运行于端系统、分组交换机和其他因特网部件中

协议作用：控制因特网中信息的接受和发送

**因特网工程任务组（Internet Engineering Task Force，IETF）** 的标准文档**请求评论（Request For Comment，RFC）** 定义了TCP、IP、HTTP和SMTP等协议

**IEEE 802**定制了以太网和无线WiFi的标准

### 1.1.2 服务描述

因特网的两种描述方法：

- 根据因特网的硬件和软件组建来描述（1.1.1）
- 根据基础设施像分布式应用程序提供的服务来描述（1.1.2）

**分布式应用程序（distributed application）：** 涉及多台相互交换数据的端系统

- 电子邮件、Web、即时讯息、VoIP、流式视频、分布式游戏、P2P文件共享

**应用程序编程接口（Application Programming Interface）：** 

- 由与因特网相连的端系统提供
- 规定了运行在一个端系统上的软件请求因特网基础设施向运行在另一个端系统上的特定目的地软件交付数据的方式

### 1.1.3 协议

**网络协议：** 定义了在两个或多个通信实体之间交互的报文格式和次序，以及报文发送和/或接收一条报文或其他事件所采取的动作

```
sequenceDiagram
Kevin->>Leo: 你有没有发现
Leo->>Kevin: 是
Client->>Server: TCP连接请求
Server->>Client: TCP连接响应
Kevin->>Leo: 香香的滋味
Leo->>Kevin: 你吃过没
Client->>Server: GET http://xxx.xxx.xxx
Server->>Client: <文件>
```

## 1.2 网络边缘

**端系统**也成为**主机**，是网络最边缘的部分，因为它们容纳（运行）应用程序：Web浏览器、Web服务器等

主机分为两类：

- 客户端（client）：等同于PC、笔记本、手机
- 服务器（server）：等同于更强大的机器、存储发布Web页面、流视频

> 大部分服务器属于大型数据中心，例如Google数据中心，每个数据中心有十万台以上服务器

### 1.2.1 接入网

**接入网（access network）：** 将端系统连接到其边缘路由器（edge router）的物理链路

**1. 家庭接入：DSL、电缆、FTTH、拨号和卫星**

**数字用户线（Digital Subscriber Line，DSL）：** 住户通过电话线获得DSL因特网接入

- 用户的**DSL调制解调器**使用电话线（双绞铜线）与本地中心局（CO）的**数字用户线接入复用器（DSLAM）** 来交换数据
    - 用户的DSL调制解调器得到数字数据后转换为高频音，通过电话线传输给CO
    - CO的DSLAM把多家的模拟信号转换回数字形式

电话线同时承载数据和传统电话信号，编码为不同的频率：

- 高速下行信道，位于50kHz到1MHz频段
- 中速上行信道，位于4kHz到50kHz频段
- 普通的双向电话信道，位于0到4kHz频段

> 用户的分频器把数据信号和电话信号分隔开，把数据信号转发给DSL调制解调器

DSL标准定义带宽（上下行不对称）：

- [ITU 1999]：12Mbps下行，1.8Mbps上行
- [ITU 2003]：24Mbps下行，2.5Mbps上行

> 住宅到CO超过5~10英里不可用DSL接入

**电缆因特网接入（cable Internet access）：** 住户通过有线电视基础设施接入

- 用户的**电缆调制解调器（cable modem）** 通过以太网口连接到家庭PC
- 电缆头端用**电缆调制解调器端接系统（Cable Modem Termination System，CMTS）** 把用户的模拟信号转换成数字形式

DOCSIS 2.0标准定义带宽（上下行不对称）：

- 42.8Mbps下行，30.7Mbps上行

> 电缆因特网**共享广播媒体**，多用户同时用上行或者下行速度会很慢

**光纤到户（Fiber To The Home，FTTH）：** 最简单的光线分布网络——直接光纤，本地中心局设置一根光纤，到相对接近若干家庭的位置，分成每户一根光纤

两种光纤分布体系结构：

- 主动光纤网络（Active Optical Network，AON）
- 被动光纤网络（Passive Optical Network，PON）：就是交换因特网

PON结构：

- 家庭有一个**光纤网络端接器（Optical Network Terminator）** 连接到**分配器（splitter）** 
- **分配器（splitter）** 把100个以下的家庭集结到一根共享光纤，该光纤连接到中心局的**光纤线路端接器（Optical Line Terminator，OLT）** OLT提供了光信号和电信号之间的转换

**2. 企业或家庭接入：以太网和WiFi**

**以太网：** 目前最流行的局域网（LAN）技术，把端用户连接到边缘路由器

- 以太网用户（100Mbps）用双绞铜线与一台以太网交换机相连

**局域无线接入：WiFi（基于IEEE 802.11）**

无线LAN用户必须位于接入点的几十米范围内

**3. 广域无线接入：3G，4G和LTE**

通过蜂窝网提供商运营的基站来发送和接受分组。

与WiFi不同的是，用户需要位于基站数万米的范围内

3G为分组交换广域无线因特网提供了超过1 Mbps的速率

### 1.2.2 物理媒体

比特从一个端系统，通过一系列链路和路由器，到达另一个端系统，需要通过物理媒体（physical media）

物理媒体划分为两类：

- 导引型媒体（guided media）：电波沿着固体媒体前行
	- 双铜绞线、同轴电缆、多模光纤缆
- 非导引型媒体（unguided media）：电波在空气或外层空间中传播
	- 陆地无线电信道、卫星无线电信道

**1. 双铜绞线：适合LAN**

组成：由多根1mm铜线以螺旋形式排列组成双绞线，多根双绞线组合在一起变成电缆（俗称网线）

无屏蔽双绞线（Unshielded Twisted Pair，UTP）常用于局域网，速率10Mbps-10Gbps，取决于线的粗细和传输距离

> 6a类双绞线达到10Gbps速率，距离长达100m，双绞线是高速LAN联网的主要方式

**2. 同轴电缆**

组成：由两个（同心，非并行）铜导体组成

工作原理：发送设备将数字信号调制到特定频段，产生的模拟信号从发送设备传送到一个或多个地方

> 同轴电缆能被用导引型共向媒体（shared medium）：多个端系统相连，都能收到其他端系统发送的数据

**3. 光纤：适合主干网**

组成：一种细而柔软、能够导引光脉冲的媒体，每个脉冲表示一个比特

优点：

- 支持极高比特速率，高达千兆网络
- 不受电磁干扰，长达100km的光缆信号衰减极低，并且很难窃听

缺点：光设备（发射器，接收器，交换机）成本高昂，因此不适合短途传输（LAN）

光载波（Optical Carrier，OC）标准：OC-n

- 链路速率等于：n x 51.8Mbps
- 正在使用的标准包括：OC-1、OC-3、OC-12、OC-24、OC-48、OC-96、OC-192、OC-768

**4. 陆地无线电信道**

无线电信道承载电磁频谱中的信号

极大的依赖于：

- 路径损耗和遮挡衰落（信号阔距离传播和绕过/通过阻碍物体时信号降低强度）
- 多径衰落（干扰对象信号反射）
- 干扰（其他无线电信道或电磁信号）

陆地无线电信道三大类：

- 第一类运行在很短距离（1米或2米）：蓝牙
- 第二类运行在局域（十到几百米）：WiFi
- 第三类运行在广域（数万米）：4G

**5. 卫星无线电信道**

一颗通信卫星连接两个或多个位于地球的微波发射方/接收方（地面站）

两类通信卫星：

- 同步卫星（geostationary satellite）：永久停留地球上方36000km高度，280ms传播时延
- 近地轨道卫星（Low-Earth Orbiting，LEO）

## 1.3 网络核心

网络链路和交换机移动数据的两种基本方法：

- 分组交换（packet switching）
- 电路交换（circuit switching）

### 1.3.1 分组交换

源端系统把报文划分较小的数据块，称之为**分组（packet）**，通过通信链路和分组交换机传送

分组：L比特  
链路传输速率：R比特/秒  
传输该分组时间：L/R秒

**1. 存储转发传输**


**存储转发传输（store-and-forward transmission）机制：** 交换机能够开始向输出链路输出该分组的第一个比特之前，必须接受到整个分组

运作流程：

- 分组1的前沿以及到达路由器
- 路由器缓存该分组并且继续等待分组1后续比特
- 路由器获得完整分组1后，转发该分组

路由器接受分组1用时L/R秒，转发分组1用时L/R秒，总用时2L/R秒。

> 路由器开始转发分组1的同时开始接受分组2的比特

P个分组经过N条链路序列的端到端时延：d~端到端~ = (P+1) * N * L/R

**2. 排队时延和分组丢失**

每个分组交换机由多条链路，每条链路有一个**输出缓存（output buffer）**（也称为**输出队列output queue**）

- 排队时延（queue delay）：如果到达的分组发现链路正在传输其他分组，则该分组必须在输出缓存中等待
- 分组丢失（丢包）（packet lost）：如果到达的分组发现链路正在传输其他分组并且输出缓存满了，则丢包

**3. 转发表和路由选择协议**

每个端系统有一个IP地址，当源端系统向目的端系统发送分组时，源在分组的首部包含了目的的IP地址

路由器的转发表（forwarding table）：用于将目的地址（或目的地址的一部分）映射成为输出链路。

运作流程：

- 分组到达路由器
- 路由器检查首部IP地址，并且用这个地址搜索转发表
- 发现适当的出链路，路由器将该分组导向该出链路

> 路由选择协议（routing protocol）自动设置转发表

### 1.3.2 电路交换

电路交换网络：在端系统间通信会话期间，**预留了**端系统间通信沿路经所需要的资源（缓存，链路传输速率）

传统电话网络就是电路交换网络的例子：

- 接收方之间建立一条端到端（end-to-end connection）连接
- 互相以**恒定**速率向对方传送速率

**1. 电路交换网络中的复用**

- 频分复用（Frequency-Division Multiplexing，FDM）
- 时分复用（Time-Division Multiplexing，TDM）

频分复用：链路的频谱由跨越链路创建的所有连接共享

> 电话每个频段由4kHz带宽  

> 调频无线电台也使用FDM来共享88~108MHz的频谱，每个电台分配一个特定频段


时分复用：时间被划分为固定区间的帧，每个帧划分为固定数量的时隙

> 每个时隙由固定的发送方接受方使用

**2. 分组交换与电路交换的对比**

电路交换不考虑需求，预先分配了传输链路的使用，使得已经分配而不使用的链路时间被浪费（打电话的时候不说话）

分组交换的时延可变并且不可预测

### 1.3.3 网络的网络

网络结构1：一层结构，全世界只有一个ISP

网络结构2：两层结构，全世界多个顶层ISP和底层接入ISP

网络结构3：每个城市接入ISP，它们与省级ISP连接，省级ISP与国家级ISP连接，国家级ISP与第一层ISP连接

网络结构4：接入ISP、区域ISP、第一层ISP、PoP（Point of Presence）、多宿、对等和IXP组成

网络结构5：在网络结构4顶部增加内容提供商网络（content provider network）

## 1.4 分组交换网中的时延,丢包和吞吐量

### 1.4.1 分组交换中的时延概述

一个分组经过一个结点会经历**结点总时延（total nodal delay）：d~nodal~ = d~proc~ + d~queue~ + d~trans~ + d~prop~**：

- 处理时延（nodal processing delay）
- 排队时延（queuing delay）
- 传输时延（transmission delay）
- 传播时延（propagation delay）

**1. 处理时延：d~proc~**

- 检查分组首部和决定将该分组导向何处所需要的时间
- 检查比特级别差错所需要的时间

**2. 排队时延：d~queue~**

- 分组交换机的输出缓存里没有分组时：排队时延为0
- 分组交换机的输出缓存里有分组等待时：排队时延d~queue~

**3. 传输时延：d~trans~**

- 分组按比特传输，从第一个比特到最后一个比特传输所需时间：d~trans~=L/R

**4. 传播时延：d~prop~**

- 路由器A和路由器B之间链路传播所需的时间

### 1.4.2 排队时延和丢包

- 分组到达平均速率：a（单位：分组/秒，pkt/s）
- 传输速率：R（单位：比特/秒，bps）
- 分组长度：L（单位：比特）

流量强度（traffic intensity）：La/R

> 流量强度如果大于1，说明比特到达队列的平均速率超过传输出去的速率

流量工程铁律：设计系统时流量强度不能大于1

### 1.4.3 端到端时延

源主机和目的逐渐之间有N-1太路由器。

- 每台路由器和源主机上的处理时延是d~proc~
- 每台路由器和源主机上的输出速率是d~trans~=L/R
- 每条链路的传播时延是d~prop~

综上端到端时延：d~end-end~ = N（d~proc~ + d~trans~ + d~prop~）

### 1.4.4 计算机网络中的吞吐量

**瞬时吞吐量（instantaneous throughput）：** 主机A到主机B传送大文件时，任何时间主机B接受到该文件的速率（单位bps）

**平均吞吐量（average throughput）：F/T bps** 主机B接受到所有F比特用去T秒

**吞吐量**是**瓶颈链路（bottleneck link）** 的传输速率 = min{R~c~, R~s~}

- 服务器与路由器之间的链路速率：R~s~
- 路由器与客户端之间的链路速率：R~c~

## 1.5 协议层次及其服务模型

### 1.5.1 分层的体系结构

**1. 协议分层**

五层因特网协议栈

名称|分组名称|经典协议
---|---|---
应用层|报文（message）|HTTP，SMTP，FTP
运输层|报文段（segment）|TCP，UDP
网络层|数据报（datagram）|IP
链路层|帧（frame）|以太网、DOCSIS
物理层|比特（bit）|物理层协议

### 1.5.2 封装

![image](https://raw.githubusercontent.com/KEVISONG/e-notebooks/master/Computer%20Networks/pics/Figure1.24.png)

**封装（encapsulation）**：

- 在发送主机端，一个**应用层报文（application-layer message）** 被传送给运输层
- 在运输层，运输层附上首部信息（运输层首部信息），产生**运输层报文段（transport-layer segment）** 被传送给网络层
- 在网络层，网络层附上首部信息（如源目ip），产生**网络层数据包（network-layer datagram）** 被传送给链路层
- 在链路层，链路层附上首部信息，产生**链路层帧（link-layer frame）**

> 每一层的每一个分组有两种类型的字段：**首部字段**和**有效载荷字段（payload field）**

## 1.6 面对攻击的网络

**1. 攻击个人计算机**

**自我复制（self-replicating）**：一旦感染了一台主机，就会寻求进入更多的主机

**病毒（virus）**：需要某种形式的用户交互来感染用户设备的恶意软件

**蠕虫（worm）**：无需某种形式的用户交互来感染用户设备的恶意软件

**2. 攻击服务器**

**拒绝服务攻击（Denial-of-Service（Dos）attack）**：网络，主机或其他基础设施不能由合法用户所使用

三种DoS攻击：

- 弱点攻击：向一台主机上易受攻击的应用程序发送制作精细的报文
- 带宽泛洪：攻击者向目标主机发送大量的分组
- 连接泛洪：攻击者在目标主机中创建大量的半开或全开TCP连接

> 分布式Dos（Distributed DoS，DDoS）：攻击者控制大量主机攻击服务器

**3. 抓包**

分组嗅探器（packet sniffer）：安装在无线传输设备附近的被动接收机，获得传输的每个分组副本

**4. IP哄骗（IP spoofing）**

用虚假源地址的人工制作的分组注入因特网

> 应对方式：端点鉴别

[返回顶部](https://github.com/KEVISONG/e-notebooks/blob/master/Computer%20Networks/第1章%20计算机网络和因特网.md)